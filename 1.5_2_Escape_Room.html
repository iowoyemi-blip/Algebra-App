<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Exponents Escape Room â€” Honors Set 1 (Student)</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
<style>
  :root{ --bg:#ffffff; --fg:#111827; --muted:#6b7280; --ok:#059669; --bad:#dc2626; --card:#f9fafb; --brand:#0ea5e9; }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
  header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid #e5e7eb;}
  .wrap{max-width:980px;margin:0 auto;padding:16px 20px;}
  h1{font-size:clamp(22px,2.2vw,30px);margin:6px 0 2px}
  p.sub{margin:0 0 8px;color:var(--muted)}
  .rooms{display:grid;grid-template-columns:1fr;gap:18px;margin:22px 0 40px}
  @media (min-width:900px){.rooms{grid-template-columns:1fr 1fr}}
  .room{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.04)}
  .room .title{display:flex;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid #e5e7eb}
  .badge{font-size:12px;color:white;background:var(--brand);padding:2px 8px;border-radius:999px}
  .content{padding:14px 16px}
  .problem{display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:center;padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;margin-bottom:10px}
  .idx{font-weight:700;color:#4b5563}
  .input-area{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type="text"]{flex:1;min-width:180px;padding:10px 12px;border-radius:10px;border:1px solid #d1d5db;font-size:15px}
  button.small{padding:8px 10px;border:1px solid #d1d5db;background:#fff;border-radius:10px;font-size:13px;cursor:pointer}
  button.small:hover{border-color:#9ca3af}
  .feedback{font-size:13px}
  .ok{color:var(--ok)}
  .bad{color:var(--bad)}
  .room-footer{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-top:1px solid #e5e7eb;background:#fff;border-bottom-left-radius:16px;border-bottom-right-radius:16px}
  .lock{font-weight:600;color:#6b7280}
  .unlock{color:var(--ok);font-weight:700}
  .pill{padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;color:#374151;font-size:13px}
  .help{color:#374151}
  .katex{font-size:1.15em}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Exponents Escape Room â€” Honors Set 1 (Student)</h1>
      <p class="sub">Solve all problems in a room to unlock the next. Enter simplified answers (no spaces). Write your final answers with <strong>positive exponents only</strong>.</p>
    </div>
  </header>

  <main class="wrap">
    <div class="rooms" id="rooms"></div>
  </main>

<script>
function renderKatex(el, tex){ try{ katex.render(tex, el, {throwOnError:false}); }catch(e){ el.textContent = tex; } }

const ROOMS = [
  { name:'Room 1 â€” Mild ðŸŒ¶', blurb:'Warm-up powers & quotients', problems:[
    {q:'(n \\cdot 2n^{4})^{3}', ans:'8n^15'},
    {q:'\\dfrac{5x}{5x^{3} \\cdot 2x^{3}}', ans:'1/(2x^5)'},
    {q:'\\left( \\dfrac{m^{3}}{2m^{4}} \\right)^{2}', ans:'1/(4m^2)'},
  ]},
  { name:'Room 2 â€” Medium ðŸŒ¶ðŸŒ¶ðŸŒ¶', blurb:'Products and powers combined', problems:[
    {q:'ab^{2} \\cdot (2ab^{3})^{3}', ans:'8a^4b^11'},
    {q:'\\dfrac{(-x^{2}y^{4})^{5}}{x^{2}y^{3}}', ans:'-x^8y^17'},
    {q:'\\dfrac{2m^{2}n^{5}}{(mn)^{5} \\cdot n^{4}}', ans:'2/(m^3n^4)'},
  ]},
  { name:'Room 3 â€” Spicy ðŸŒ¶ðŸŒ¶ðŸŒ¶ðŸŒ¶ (Part 1)', blurb:'Nested powers & quotients', problems:[
    {q:'\\left( \\dfrac{(x^{2}y^{3} \\cdot -x^{5})^{3}}{2x^{3}y^{2}} \\right)^{2}', ans:'(x^36y^14)/4'},
  ]},
  { name:'Room 4 â€” Spicy ðŸŒ¶ðŸŒ¶ðŸŒ¶ðŸŒ¶ (Part 2)', blurb:'More nested expressions', problems:[
    {q:'\\dfrac{((yx^{2})^{2} \\cdot 2x^{3}y^{2})^{3}}{(x^{2}y^{3})^{2}}', ans:'8x^17y^6'},
  ]},
];

function sectionHTML(roomIndex){
  const r = ROOMS[roomIndex];
  return `
  <section class="room" data-room="${roomIndex}">
    <div class="title">
      <span class="badge">${roomIndex+1}/4</span>
      <div>
        <div style="font-weight:700">${r.name}</div>
        <div class="help">${r.blurb}</div>
      </div>
    </div>
    <div class="content">
      ${r.problems.map((p,i)=>`
        <div class="problem" data-i="${i}">
          <div class="idx">${i+1}.</div>
          <div>
            <div class="q" data-tex="${p.q.replace(/"/g,'&quot;')}"></div>
            <div class="input-area">
              <input type="text" placeholder="type your simplified answer" />
              <button class="small check">Check</button>
              <span class="feedback"></span>
            </div>
          </div>
        </div>
      `).join('')}
    </div>
    <div class="room-footer">
      <span class="lock">Solve all in this room to unlock the next.</span>
      <button class="small pill summary">Room Progress</button>
    </div>
  </section>`
}

function normalize(input){
  // 1) Trim spaces
  let s=(input||'').trim().replace(/\s+/g,'');

  // 2) If the user types a reciprocal like 1/(2x^5), rewrite to 1/2*x^-5
  const m = s.match(/^1\/\(([^()]+)\)$/);
  if(m){
    let den = (m[1]||'').replace(/[()]/g,'');
    // insert * between number and variable (2x^5 -> 2*x^5)
    den = den.replace(/(\d)([a-zA-Z])/g, function(_,d,l){ return d+'*'+l; });
    // insert * between adjacent variable groups (x^2y^3 -> x^2*y^3)
    den = den.replace(/([a-zA-Z](?:\^-?\d+)?)([a-zA-Z])/g, function(_,a,b){ return a+'*'+b; });
    const toks = den.split('*').filter(Boolean);
    let rebuiltCoeff = '1';
    let rebuiltVars = [];
    for(const tk of toks){
      if(/^-?\d+$/.test(tk)){
        rebuiltCoeff = mulFrac(rebuiltCoeff, '1/'+tk); // multiply by reciprocal of number
      }else if(/^[a-zA-Z]+(?:\^-?\d+)?$/.test(tk)){
        const parts = tk.split('^');
        const v = parts[0];
        const pow = parts.length>1 ? parseInt(parts[1],10) : 1;
        rebuiltVars.push(v+'^'+(-pow));
      }else{
        rebuiltVars.push(tk);
      }
    }
    const rebuilt = (rebuiltCoeff==='1'? '' : rebuiltCoeff==='-1'? '-' : rebuiltCoeff) + (rebuiltVars.length? '*'+rebuiltVars.join('*') : '');
    s = rebuilt.replace(/^\*|\*$/g,'');
  }

  // 3) Normalize implicit multiplications in the remaining input
  s = s.replace(/(\d)([a-zA-Z])/g, function(_,d,l){ return d+'*'+l; });
  s = s.replace(/([a-zA-Z])(\d)/g, function(_,l,d){ return l+'*'+d; });

  // 4) Split into coefficient and variable parts
  const parts=s.split('*').filter(Boolean); let coeff='1'; const vars=[];
  for(const p of parts){ if(/^[+-]?(\d+)(\/\d+)?$/.test(p)){ coeff=mulFrac(coeff,p);} else { vars.push(p);} }
  // 5) Sort variable factors for canonical form
  vars.sort((a,b)=>a.localeCompare(b));
  const joined=(coeff==='1'?'' : coeff==='-1'?'-':coeff)+'*'+vars.join('*');
  return joined.replace(/^\*|\*$/g,'');
}

function correct(expected,input){
  return normalize(expected)===normalize(input);
}

function build(){
  const container=document.getElementById('rooms');
  container.innerHTML=ROOMS.map((_,i)=>sectionHTML(i)).join('');
  [...container.querySelectorAll('.q')].forEach(el=>{ const t=el.getAttribute('data-tex')||''; renderKatex(el,t); });
  const sections=[...container.querySelectorAll('.room')];
  sections.forEach((sec,idx)=>{ if(idx>0){sec.style.opacity=.5; sec.style.pointerEvents='none'} });
  sections.forEach((sec,roomIdx)=>{
    sec.addEventListener('click', (e)=>{
      if(!(e.target instanceof HTMLElement)) return;
      if(e.target.classList.contains('check')){
        const probEl=e.target.closest('.problem');
        const i=Number(probEl.dataset.i);
        const ans=ROOMS[roomIdx].problems[i].ans;
        const input=probEl.querySelector('input').value;
        const fb=probEl.querySelector('.feedback');
        if(correct(ans,input)){ fb.textContent='Correct!'; fb.className='feedback ok'; probEl.style.borderColor='#86efac'; }
        else { fb.textContent='Try again'; fb.className='feedback bad'; probEl.style.borderColor='#fecaca'; }
        checkUnlock(roomIdx);
      }
      if(e.target.classList.contains('summary')){
        const solved=[...sec.querySelectorAll('.feedback.ok')].length; const total=ROOMS[roomIdx].problems.length; alert(`${ROOMS[roomIdx].name}: ${solved}/${total} solved`);
      }
    });
  });
}

function checkUnlock(roomIdx){
  const container=document.getElementById('rooms');
  const sections=[...container.querySelectorAll('.room')];
  const sec=sections[roomIdx];
  const solved=[...sec.querySelectorAll('.feedback.ok')].length;
  const total=ROOMS[roomIdx].problems.length;
  if(solved===total && roomIdx<sections.length-1){
    const next=sections[roomIdx+1]; next.style.opacity=1; next.style.pointerEvents='auto';
    const footer=sec.querySelector('.room-footer .lock'); if(footer){ footer.textContent='Room cleared! Next room unlocked.'; footer.className='unlock'; }
  }
}

document.addEventListener('DOMContentLoaded', build);
</script>
</body>
</html>
